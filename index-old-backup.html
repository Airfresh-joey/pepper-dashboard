<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joey's Executive Dashboard | Pepper</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå∂Ô∏è</text></svg>">
    <style>
        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #1a1f3a;
            --bg-card: #252b48;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --accent: #667eea;
            --accent-dark: #5568d3;
            --accent-light: #764ba2;
            --success: #48bb78;
            --warning: #f6ad55;
            --danger: #fc8181;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #1a1f3a 100%);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Background Pattern */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.1) 0%, transparent 50%);
            z-index: -1;
            pointer-events: none;
        }

        /* Header */
        .header {
            background: rgba(26, 31, 58, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 2.5rem;
        }

        .title-block h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .time-display {
            text-align: right;
        }

        .time {
            font-size: 1.5rem;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
        }

        .date {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .logout-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(252, 129, 129, 0.1);
            border: 1px solid var(--danger);
            border-radius: 8px;
            color: var(--danger);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
            transform: translateY(-2px);
        }

        /* Main Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Grid Layouts */
        .grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        /* Card Styles */
        .card {
            background: rgba(37, 43, 72, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-icon {
            font-size: 1.5rem;
        }

        .card-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-success {
            background: rgba(72, 187, 120, 0.2);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(246, 173, 85, 0.2);
            color: var(--warning);
        }

        /* Weather Widget */
        .weather-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .weather-temp {
            font-size: 4rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            line-height: 1;
        }

        .weather-icon {
            font-size: 5rem;
            filter: drop-shadow(0 4px 12px rgba(102, 126, 234, 0.3));
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .weather-detail {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .detail-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .detail-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Ski Conditions */
        .ski-resort {
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--accent);
        }

        .resort-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .resort-name {
            font-weight: 600;
            font-size: 1.05rem;
        }

        .resort-temp {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
        }

        .resort-stats {
            display: flex;
            gap: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Company Cards */
        .company-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .company-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent);
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
        }

        .company-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            filter: drop-shadow(0 4px 12px rgba(102, 126, 234, 0.5));
        }

        .company-name {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .company-stats {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .stat-highlight {
            color: var(--accent);
            font-weight: 600;
        }

        /* Status Indicators */
        .status-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid var(--success);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
            box-shadow: 0 0 12px var(--success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-content {
            flex: 1;
        }

        .status-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .status-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .status-time {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-style: italic;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .view-all-btn {
            padding: 0.5rem 1rem;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid var(--accent);
            border-radius: 8px;
            color: var(--accent);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .view-all-btn:hover {
            background: var(--accent);
            color: white;
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Pepper Chat Widget */
        .chat-widget {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }

        .chat-button {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            border: none;
            font-size: 2.5rem;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-button:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 32px rgba(102, 126, 234, 0.6);
        }

        .chat-window {
            position: absolute;
            bottom: 90px;
            right: 0;
            width: 400px;
            height: 600px;
            background: rgba(26, 31, 58, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-window.active {
            display: flex;
        }

        .chat-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h3 {
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
        }

        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .chat-message {
            padding: 1rem;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .chat-message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
            color: white;
        }

        .chat-message.pepper {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
        }

        .chat-input-area {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            background: rgba(37, 43, 72, 0.5);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.875rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: white;
            font-size: 0.95rem;
            resize: none;
            font-family: inherit;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .chat-send-btn {
            padding: 0.875rem 1.5rem;
            background: var(--accent);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            background: var(--accent-dark);
        }

        .voice-btn {
            width: 100%;
            padding: 0.875rem;
            background: rgba(252, 129, 129, 0.2);
            border: 1px solid var(--danger);
            border-radius: 12px;
            color: var(--danger);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .voice-btn:hover {
            background: var(--danger);
            color: white;
        }

        .voice-btn.recording {
            animation: recording-pulse 1s infinite;
        }

        @keyframes recording-pulse {
            0%, 100% { background: rgba(252, 129, 129, 0.3); }
            50% { background: rgba(252, 129, 129, 0.6); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }

            .chat-window {
                width: calc(100vw - 4rem);
                right: 2rem;
                left: 2rem;
            }

            .weather-temp {
                font-size: 3rem;
            }

            .weather-icon {
                font-size: 3.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">üå∂Ô∏è</div>
                <div class="title-block">
                    <h1>Executive Command Center</h1>
                    <div class="subtitle">Joey's Dashboard</div>
                </div>
            </div>
            <div class="header-right">
                <div class="time-display">
                    <div class="time" id="time"></div>
                    <div class="date" id="date"></div>
                </div>
                <button class="logout-btn" onclick="logout()">üîí Logout</button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <main class="container">
        <!-- Top Widgets -->
        <div class="grid grid-2">
            <!-- Weather Widget -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="card-icon">üå§Ô∏è</span>
                        Denver Weather
                    </h2>
                    <span class="card-badge badge-success" id="weatherStatus">Live</span>
                </div>
                <div class="weather-main">
                    <div class="weather-temp" id="weatherTemp">--¬∞</div>
                    <div class="weather-icon" id="weatherIcon">üå°Ô∏è</div>
                </div>
                <div class="weather-details" id="weatherDetails">
                    <div class="weather-detail">
                        <span class="detail-label">Condition</span>
                        <span class="detail-value" id="weatherCondition">--</span>
                    </div>
                    <div class="weather-detail">
                        <span class="detail-label">Feels Like</span>
                        <span class="detail-value" id="weatherFeels">--¬∞</span>
                    </div>
                    <div class="weather-detail">
                        <span class="detail-label">Humidity</span>
                        <span class="detail-value" id="weatherHumidity">--%</span>
                    </div>
                    <div class="weather-detail">
                        <span class="detail-label">Wind</span>
                        <span class="detail-value" id="weatherWind">-- mph</span>
                    </div>
                </div>
            </div>

            <!-- Ski Conditions Widget -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <span class="card-icon">‚õ∑Ô∏è</span>
                        Colorado Ski Conditions
                    </h2>
                    <span class="card-badge badge-success" id="skiStatus">Live</span>
                </div>
                <div id="skiResorts">
                    <div class="loading"></div> Loading resort data...
                </div>
            </div>
        </div>

        <!-- Company Status Section -->
        <div class="section-header">
            <h2 class="section-title">
                <span>üè¢</span>
                Companies & Projects
            </h2>
        </div>
        <div class="grid grid-4">
            <div class="company-card" onclick="alert('Air Fresh Marketing - Opening detailed view...')">
                <div class="company-icon">üí®</div>
                <div class="company-name">Air Fresh Marketing</div>
                <div class="company-stats">
                    <span class="stat-highlight">3</span> Active Projects<br>
                    <span class="stat-highlight">85%</span> On Track
                </div>
            </div>
            
            <div class="company-card" onclick="alert('Humming Agent AI - Opening detailed view...')">
                <div class="company-icon">üê¶</div>
                <div class="company-name">Humming Agent AI</div>
                <div class="company-stats">
                    <span class="stat-highlight">2</span> Active Projects<br>
                    <span class="stat-highlight">90%</span> On Track
                </div>
            </div>
            
            <div class="company-card" onclick="alert('Immerse Forge - Opening detailed view...')">
                <div class="company-icon">üéÆ</div>
                <div class="company-name">Immerse Forge</div>
                <div class="company-stats">
                    <span class="stat-highlight">4</span> Active Projects<br>
                    <span class="stat-highlight">75%</span> On Track
                </div>
            </div>
            
            <div class="company-card" onclick="alert('Street Teams Co - Opening detailed view...')">
                <div class="company-icon">üö∂</div>
                <div class="company-name">Street Teams Co</div>
                <div class="company-stats">
                    <span class="stat-highlight">5</span> Active Campaigns<br>
                    <span class="stat-highlight">92%</span> On Track
                </div>
            </div>
            
            <div class="company-card" onclick="alert('College Marketing - Opening detailed view...')">
                <div class="company-icon">üéì</div>
                <div class="company-name">College Marketing</div>
                <div class="company-stats">
                    <span class="stat-highlight">3</span> Active Campaigns<br>
                    <span class="stat-highlight">88%</span> On Track
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="section-header">
            <h2 class="section-title">
                <span>üìä</span>
                Recent Activity
            </h2>
            <button class="view-all-btn">View All</button>
        </div>
        <div class="grid grid-2">
            <div class="card">
                <h3 class="card-title">
                    <span class="card-icon">‚úÖ</span>
                    Latest Updates
                </h3>
                <div class="status-list" id="latestUpdates">
                    <div class="status-item">
                        <div class="status-indicator"></div>
                        <div class="status-content">
                            <div class="status-title">Campaign Launch Successful</div>
                            <div class="status-description">Air Fresh Marketing Q1 campaign deployed</div>
                            <div class="status-time">2 hours ago</div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-indicator"></div>
                        <div class="status-content">
                            <div class="status-title">AI Model Updated</div>
                            <div class="status-description">Humming Agent AI v2.1 deployed to production</div>
                            <div class="status-time">4 hours ago</div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-indicator"></div>
                        <div class="status-content">
                            <div class="status-title">Event Coordination Complete</div>
                            <div class="status-description">Street Teams Co finished 3 Denver events</div>
                            <div class="status-time">6 hours ago</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">
                    <span class="card-icon">üìÖ</span>
                    Upcoming Tasks
                </h3>
                <div class="status-list" id="upcomingTasks">
                    <div class="status-item">
                        <div class="status-indicator" style="background: var(--warning); box-shadow: 0 0 12px var(--warning);"></div>
                        <div class="status-content">
                            <div class="status-title">Client Presentation</div>
                            <div class="status-description">Air Fresh Marketing - Quarterly Review</div>
                            <div class="status-time">Today, 4:00 PM</div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-indicator" style="background: var(--accent); box-shadow: 0 0 12px var(--accent);"></div>
                        <div class="status-content">
                            <div class="status-title">Strategy Meeting</div>
                            <div class="status-description">Humming Agent AI - Product Roadmap</div>
                            <div class="status-time">Tomorrow, 10:00 AM</div>
                        </div>
                    </div>
                    <div class="status-item">
                        <div class="status-indicator" style="background: var(--success); box-shadow: 0 0 12px var(--success);"></div>
                        <div class="status-content">
                            <div class="status-title">VR Demo Session</div>
                            <div class="status-description">Immerse Forge - Client Showcase</div>
                            <div class="status-time">Friday, 2:00 PM</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Pepper Chat Widget -->
    <div class="chat-widget">
        <button class="chat-button" onclick="toggleChat()">
            üå∂Ô∏è
        </button>
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <h3>üí¨ Chat with Pepper</h3>
                <button class="chat-close" onclick="toggleChat()">√ó</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="chat-message pepper">
                    üëã Hi Joey! I'm Pepper, your AI assistant. How can I help you today?
                </div>
            </div>
            <div class="chat-input-area">
                <div class="chat-input-wrapper">
                    <textarea 
                        class="chat-input" 
                        id="chatInput" 
                        placeholder="Type your message..."
                        rows="2"
                    ></textarea>
                    <button class="chat-send-btn" onclick="sendMessage()">üí¨</button>
                </div>
                <button class="voice-btn" id="voiceBtn" onclick="toggleVoice()">
                    üé§ Voice Message
                </button>
            </div>
        </div>
    </div>

    <script>
        // Check authentication
        if (!sessionStorage.getItem('authenticated')) {
            window.location.href = 'login.html';
        }

        // ============= TIME & DATE =============
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            });
            const dateStr = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('time').textContent = timeStr;
            document.getElementById('date').textContent = dateStr;
        }
        updateTime();
        setInterval(updateTime, 1000);

        // ============= WEATHER API =============
        async function loadWeather() {
            try {
                const lat = 39.7392;
                const lon = -104.9903;
                
                const response = await fetch(
                    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2f,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=America/Denver`
                );
                
                if (!response.ok) throw new Error('Weather API error');
                
                const data = await response.json();
                const current = data.current;
                
                // Weather codes to emoji and description
                const weatherMap = {
                    0: { icon: '‚òÄÔ∏è', desc: 'Clear Sky' },
                    1: { icon: 'üå§Ô∏è', desc: 'Mainly Clear' },
                    2: { icon: '‚õÖ', desc: 'Partly Cloudy' },
                    3: { icon: '‚òÅÔ∏è', desc: 'Overcast' },
                    45: { icon: 'üå´Ô∏è', desc: 'Foggy' },
                    48: { icon: 'üå´Ô∏è', desc: 'Rime Fog' },
                    51: { icon: 'üå¶Ô∏è', desc: 'Light Drizzle' },
                    53: { icon: 'üåßÔ∏è', desc: 'Drizzle' },
                    55: { icon: 'üåßÔ∏è', desc: 'Heavy Drizzle' },
                    61: { icon: 'üåßÔ∏è', desc: 'Light Rain' },
                    63: { icon: 'üåßÔ∏è', desc: 'Rain' },
                    65: { icon: '‚õàÔ∏è', desc: 'Heavy Rain' },
                    71: { icon: 'üå®Ô∏è', desc: 'Light Snow' },
                    73: { icon: '‚ùÑÔ∏è', desc: 'Snow' },
                    75: { icon: '‚ùÑÔ∏è', desc: 'Heavy Snow' },
                    77: { icon: 'üå®Ô∏è', desc: 'Snow Grains' },
                    80: { icon: 'üå¶Ô∏è', desc: 'Light Showers' },
                    81: { icon: 'üåßÔ∏è', desc: 'Showers' },
                    82: { icon: '‚õàÔ∏è', desc: 'Heavy Showers' },
                    85: { icon: 'üå®Ô∏è', desc: 'Light Snow Showers' },
                    86: { icon: '‚ùÑÔ∏è', desc: 'Heavy Snow Showers' },
                    95: { icon: '‚õàÔ∏è', desc: 'Thunderstorm' },
                    96: { icon: '‚õàÔ∏è', desc: 'Thunderstorm with Hail' },
                    99: { icon: '‚õàÔ∏è', desc: 'Heavy Thunderstorm' }
                };
                
                const weather = weatherMap[current.weather_code] || { icon: 'üå°Ô∏è', desc: 'Unknown' };
                
                document.getElementById('weatherTemp').textContent = `${Math.round(current.temperature_2m)}¬∞`;
                document.getElementById('weatherIcon').textContent = weather.icon;
                document.getElementById('weatherCondition').textContent = weather.desc;
                document.getElementById('weatherFeels').textContent = `${Math.round(current.apparent_temperature)}¬∞`;
                document.getElementById('weatherHumidity').textContent = `${current.relative_humidity_2m}%`;
                document.getElementById('weatherWind').textContent = `${Math.round(current.wind_speed_10m)} mph`;
                
                document.getElementById('weatherStatus').textContent = 'Live';
            } catch (error) {
                console.error('Weather error:', error);
                document.getElementById('weatherStatus').textContent = 'Offline';
                document.getElementById('weatherStatus').className = 'card-badge badge-warning';
                document.getElementById('weatherCondition').textContent = 'Unavailable';
            }
        }

        // ============= SKI CONDITIONS =============
        async function loadSkiConditions() {
            try {
                const resorts = [
                    { name: 'Vail', lat: 39.6403, lon: -106.3742, elevation: '10,350 ft' },
                    { name: 'Breckenridge', lat: 39.4817, lon: -106.0384, elevation: '12,998 ft' },
                    { name: 'Keystone', lat: 39.6062, lon: -105.9349, elevation: '12,408 ft' }
                ];
                
                const skiResortsEl = document.getElementById('skiResorts');
                skiResortsEl.innerHTML = '';
                
                for (const resort of resorts) {
                    const response = await fetch(
                        `https://api.open-meteo.com/v1/forecast?latitude=${resort.lat}&longitude=${resort.lon}&current=temperature_2m,weather_code,wind_speed_10m&temperature_unit=fahrenheit&wind_speed_unit=mph&timezone=America/Denver`
                    );
                    
                    if (!response.ok) continue;
                    
                    const data = await response.json();
                    const current = data.current;
                    
                    const getSnowCondition = (weatherCode) => {
                        if (weatherCode >= 71 && weatherCode <= 77) return 'üå®Ô∏è Snowing';
                        if (weatherCode >= 85 && weatherCode <= 86) return '‚ùÑÔ∏è Snow Showers';
                        if (weatherCode <= 3) return '‚òÄÔ∏è Clear';
                        return '‚õÖ Partly Cloudy';
                    };
                    
                    const resortHTML = `
                        <div class="ski-resort">
                            <div class="resort-header">
                                <div class="resort-name">‚õ∑Ô∏è ${resort.name}</div>
                                <div class="resort-temp">${Math.round(current.temperature_2m)}¬∞F</div>
                            </div>
                            <div class="resort-stats">
                                <span>üèîÔ∏è ${resort.elevation}</span>
                                <span>üí® ${Math.round(current.wind_speed_10m)} mph</span>
                                <span>${getSnowCondition(current.weather_code)}</span>
                            </div>
                        </div>
                    `;
                    
                    skiResortsEl.innerHTML += resortHTML;
                }
                
                document.getElementById('skiStatus').textContent = 'Live';
            } catch (error) {
                console.error('Ski conditions error:', error);
                document.getElementById('skiResorts').innerHTML = '<p style="color: var(--text-secondary);">Unable to load ski conditions</p>';
                document.getElementById('skiStatus').textContent = 'Offline';
                document.getElementById('skiStatus').className = 'card-badge badge-warning';
            }
        }

        // ============= CHAT FUNCTIONS =============
        let isRecording = false;
        let recognition = null;

        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.classList.toggle('active');
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            const messagesEl = document.getElementById('chatMessages');
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'chat-message user';
            userMsg.textContent = message;
            messagesEl.appendChild(userMsg);
            
            // Clear input
            input.value = '';
            
            // Scroll to bottom
            messagesEl.scrollTop = messagesEl.scrollHeight;
            
            // Simulate Pepper response
            setTimeout(() => {
                const pepperMsg = document.createElement('div');
                pepperMsg.className = 'chat-message pepper';
                
                // Smart responses based on keywords
                if (message.toLowerCase().includes('weather')) {
                    pepperMsg.textContent = 'üå§Ô∏è The weather widget above shows current Denver conditions. It\'s looking good!';
                } else if (message.toLowerCase().includes('ski')) {
                    pepperMsg.textContent = '‚õ∑Ô∏è Ski conditions are updating live! Check out Vail, Breckenridge, and Keystone above.';
                } else if (message.toLowerCase().includes('help')) {
                    pepperMsg.textContent = 'üí° I can help you check weather, ski conditions, company status, and answer questions. What would you like to know?';
                } else {
                    pepperMsg.textContent = `I received your message: "${message}". I'm currently in demo mode, but I'm processing your request!`;
                }
                
                messagesEl.appendChild(pepperMsg);
                messagesEl.scrollTop = messagesEl.scrollHeight;
            }, 800);
        }

        function toggleVoice() {
            const voiceBtn = document.getElementById('voiceBtn');
            
            if (!isRecording) {
                // Start recording
                isRecording = true;
                voiceBtn.textContent = 'üî¥ Recording...';
                voiceBtn.classList.add('recording');
                
                // Check for Web Speech API support
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    recognition = new SpeechRecognition();
                    recognition.continuous = false;
                    recognition.interimResults = false;
                    
                    recognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        document.getElementById('chatInput').value = transcript;
                        sendMessage();
                    };
                    
                    recognition.onerror = (event) => {
                        console.error('Speech recognition error:', event.error);
                        stopRecording();
                    };
                    
                    recognition.onend = () => {
                        stopRecording();
                    };
                    
                    recognition.start();
                } else {
                    // Fallback for browsers without speech recognition
                    setTimeout(() => {
                        const messagesEl = document.getElementById('chatMessages');
                        const pepperMsg = document.createElement('div');
                        pepperMsg.className = 'chat-message pepper';
                        pepperMsg.textContent = 'üé§ Voice recording captured! (In production, this would use real speech-to-text)';
                        messagesEl.appendChild(pepperMsg);
                        messagesEl.scrollTop = messagesEl.scrollHeight;
                        stopRecording();
                    }, 2000);
                }
            } else {
                // Stop recording
                if (recognition) {
                    recognition.stop();
                }
                stopRecording();
            }
        }

        function stopRecording() {
            isRecording = false;
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.textContent = 'üé§ Voice Message';
            voiceBtn.classList.remove('recording');
        }

        // Allow Enter to send message (Shift+Enter for new line)
        document.getElementById('chatInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ============= LOGOUT =============
        function logout() {
            sessionStorage.removeItem('authenticated');
            window.location.href = 'login.html';
        }

        // ============= INITIALIZE =============
        loadWeather();
        loadSkiConditions();
        
        // Refresh data periodically
        setInterval(loadWeather, 600000); // 10 minutes
        setInterval(loadSkiConditions, 900000); // 15 minutes
    </script>
</body>
</html>
