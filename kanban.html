<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pepper's Command Center | Kanban Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #ff6b6b, #f06595, #cc5de8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: #888;
            font-size: 1rem;
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .metric-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .metric-card p {
            color: #888;
            font-size: 0.9rem;
        }

        .metric-completed { border-left: 4px solid #51cf66; }
        .metric-progress { border-left: 4px solid #4dabf7; }
        .metric-priority { border-left: 4px solid #ff6b6b; }
        .metric-projects { border-left: 4px solid #f59f00; }

        .actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-add {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
        }

        .btn-add:hover {
            box-shadow: 0 8px 20px rgba(81, 207, 102, 0.4);
        }

        .filters {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .kanban {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (max-width: 1400px) {
            .kanban { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 900px) {
            .kanban { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 600px) {
            .kanban { grid-template-columns: 1fr; }
        }

        .column {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            min-height: 400px;
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .column-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .column-count {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
        }

        .column-not-started { border-top: 3px solid #868e96; }
        .column-in-progress { border-top: 3px solid #4dabf7; }
        .column-testing { border-top: 3px solid #f59f00; }
        .column-blocked { border-top: 3px solid #ff6b6b; }
        .column-completed { border-top: 3px solid #51cf66; }

        .task-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 300px;
        }

        .task {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            cursor: move;
            transition: all 0.2s;
        }

        .task:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .task.dragging {
            opacity: 0.5;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .task-title {
            font-weight: 600;
            font-size: 0.95rem;
            flex: 1;
            cursor: text;
            padding: 2px 4px;
            border-radius: 4px;
        }

        .task-title:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .task-actions {
            display: flex;
            gap: 5px;
        }

        .task-btn {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .task-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .task-btn-delete:hover {
            color: #ff6b6b;
        }

        .priority-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .priority-critical {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
        }

        .priority-high {
            background: rgba(245, 159, 0, 0.2);
            color: #f59f00;
            border: 1px solid #f59f00;
        }

        .priority-medium {
            background: rgba(77, 171, 247, 0.2);
            color: #4dabf7;
            border: 1px solid #4dabf7;
        }

        .priority-low {
            background: rgba(134, 142, 150, 0.2);
            color: #868e96;
            border: 1px solid #868e96;
        }

        .task-description {
            font-size: 0.85rem;
            color: #aaa;
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #1a1a1a;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
        }

        .modal-header {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #aaa;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 10px;
            color: white;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-cancel {
            background: rgba(255, 255, 255, 0.1);
        }

        .loader {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .error {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üå∂Ô∏è Pepper's Command Center</h1>
            <p>Operational Kanban Dashboard</p>
        </div>

        <div class="metrics">
            <div class="metric-card metric-completed">
                <h3 id="metric-completed">0</h3>
                <p>Completed</p>
            </div>
            <div class="metric-card metric-progress">
                <h3 id="metric-progress">0</h3>
                <p>In Progress</p>
            </div>
            <div class="metric-card metric-priority">
                <h3 id="metric-priority">0</h3>
                <p>High Priority</p>
            </div>
            <div class="metric-card metric-projects">
                <h3 id="metric-projects">0</h3>
                <p>Total Tasks</p>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-add" onclick="openAddModal()">+ Add Task</button>
            <div class="filters">
                <button class="filter-btn active" onclick="filterTasks('all')">All</button>
                <button class="filter-btn" onclick="filterTasks('critical')">Critical</button>
                <button class="filter-btn" onclick="filterTasks('high')">High Priority</button>
            </div>
        </div>

        <div id="error-container"></div>
        <div id="loader" class="loader" style="display: none;">Loading tasks...</div>

        <div class="kanban" id="kanban">
            <div class="column column-not-started" data-status="not-started">
                <div class="column-header">
                    <div class="column-title">üì• Backlog</div>
                    <div class="column-count" id="count-not-started">0</div>
                </div>
                <div class="task-list" id="list-not-started"></div>
            </div>

            <div class="column column-in-progress" data-status="in-progress">
                <div class="column-header">
                    <div class="column-title">‚ö° In Progress</div>
                    <div class="column-count" id="count-in-progress">0</div>
                </div>
                <div class="task-list" id="list-in-progress"></div>
            </div>

            <div class="column column-testing" data-status="testing">
                <div class="column-header">
                    <div class="column-title">üß™ Testing</div>
                    <div class="column-count" id="count-testing">0</div>
                </div>
                <div class="task-list" id="list-testing"></div>
            </div>

            <div class="column column-blocked" data-status="blocked">
                <div class="column-header">
                    <div class="column-title">üö´ Blocked</div>
                    <div class="column-count" id="count-blocked">0</div>
                </div>
                <div class="task-list" id="list-blocked"></div>
            </div>

            <div class="column column-completed" data-status="completed">
                <div class="column-header">
                    <div class="column-title">‚úÖ Done</div>
                    <div class="column-count" id="count-completed">0</div>
                </div>
                <div class="task-list" id="list-completed"></div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Task Modal -->
    <div class="modal" id="task-modal">
        <div class="modal-content">
            <div class="modal-header" id="modal-title">Add New Task</div>
            <form id="task-form" onsubmit="saveTask(event)">
                <div class="form-group">
                    <label>Task Title *</label>
                    <input type="text" id="task-title-input" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="task-description-input"></textarea>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="task-priority-input">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                        <option value="critical">Critical</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="task-status-input">
                        <option value="not-started" selected>Backlog</option>
                        <option value="in-progress">In Progress</option>
                        <option value="testing">Testing</option>
                        <option value="blocked">Blocked</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>
                <input type="hidden" id="task-id-input">
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'https://project.hummingagent.ai/api';
        const API_KEY = 'pd_lIcJX2dmXIs0jkOzP3v3iiIRLRnuv2yt';
        const PROJECT_ID = '5d3ad50f-d8ba-4a1e-8a18-ee2d6e8adee5';

        let tasks = [];
        let currentFilter = 'all';

        // Load tasks on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadTasks();
        });

        async function loadTasks() {
            showLoader(true);
            hideError();

            try {
                const response = await fetch(`${API_BASE}/tasks?project_id=${PROJECT_ID}`, {
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                tasks = await response.json();
                renderTasks();
                updateMetrics();
            } catch (error) {
                showError(`Failed to load tasks: ${error.message}`);
            } finally {
                showLoader(false);
            }
        }

        function renderTasks() {
            // Clear all lists
            ['not-started', 'in-progress', 'testing', 'blocked', 'completed'].forEach(status => {
                document.getElementById(`list-${status}`).innerHTML = '';
            });

            // Filter and render tasks
            const filteredTasks = tasks.filter(task => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'critical') return task.priority === 'critical';
                if (currentFilter === 'high') return task.priority === 'high';
                return true;
            });

            filteredTasks.forEach(task => {
                const taskElement = createTaskElement(task);
                const list = document.getElementById(`list-${task.status}`);
                if (list) {
                    list.appendChild(taskElement);
                }
            });

            // Update counts
            ['not-started', 'in-progress', 'testing', 'blocked', 'completed'].forEach(status => {
                const count = tasks.filter(t => t.status === status).length;
                document.getElementById(`count-${status}`).textContent = count;
            });

            setupDragAndDrop();
        }

        function createTaskElement(task) {
            const div = document.createElement('div');
            div.className = 'task';
            div.draggable = true;
            div.dataset.taskId = task.id;

            const priorityClass = `priority-${task.priority || 'medium'}`;
            const priorityLabel = (task.priority || 'medium').toUpperCase();

            div.innerHTML = `
                <div class="task-header">
                    <div class="task-title" onclick="editTask('${task.id}')">${task.title}</div>
                    <div class="task-actions">
                        <button class="task-btn task-btn-edit" onclick="editTask('${task.id}')" title="Edit">‚úèÔ∏è</button>
                        <button class="task-btn task-btn-delete" onclick="deleteTask('${task.id}')" title="Delete">üóëÔ∏è</button>
                    </div>
                </div>
                <div class="priority-badge ${priorityClass}">${priorityLabel}</div>
                ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
            `;

            return div;
        }

        function setupDragAndDrop() {
            const taskElements = document.querySelectorAll('.task');
            const lists = document.querySelectorAll('.task-list');

            taskElements.forEach(task => {
                task.addEventListener('dragstart', handleDragStart);
                task.addEventListener('dragend', handleDragEnd);
            });

            lists.forEach(list => {
                list.addEventListener('dragover', handleDragOver);
                list.addEventListener('drop', handleDrop);
            });
        }

        let draggedTask = null;

        function handleDragStart(e) {
            draggedTask = e.target;
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        async function handleDrop(e) {
            e.preventDefault();
            const taskList = e.target.closest('.task-list');
            if (!taskList || !draggedTask) return;

            const column = taskList.closest('.column');
            const newStatus = column.dataset.status;
            const taskId = draggedTask.dataset.taskId;

            // Update task status via API
            await updateTaskStatus(taskId, newStatus);
        }

        async function updateTaskStatus(taskId, newStatus) {
            try {
                const response = await fetch(`${API_BASE}/tasks`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        id: taskId,
                        status: newStatus
                    })
                });

                if (!response.ok) {
                    throw new Error(`Failed to update task: ${response.status}`);
                }

                // Reload tasks
                await loadTasks();
            } catch (error) {
                showError(`Failed to move task: ${error.message}`);
            }
        }

        function updateMetrics() {
            const completed = tasks.filter(t => t.status === 'completed').length;
            const inProgress = tasks.filter(t => t.status === 'in-progress').length;
            const highPriority = tasks.filter(t => t.priority === 'high' || t.priority === 'critical').length;
            const total = tasks.length;

            document.getElementById('metric-completed').textContent = completed;
            document.getElementById('metric-progress').textContent = inProgress;
            document.getElementById('metric-priority').textContent = highPriority;
            document.getElementById('metric-projects').textContent = total;
        }

        function openAddModal() {
            document.getElementById('modal-title').textContent = 'Add New Task';
            document.getElementById('task-form').reset();
            document.getElementById('task-id-input').value = '';
            document.getElementById('task-modal').classList.add('active');
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            document.getElementById('modal-title').textContent = 'Edit Task';
            document.getElementById('task-id-input').value = task.id;
            document.getElementById('task-title-input').value = task.title;
            document.getElementById('task-description-input').value = task.description || '';
            document.getElementById('task-priority-input').value = task.priority || 'medium';
            document.getElementById('task-status-input').value = task.status;
            document.getElementById('task-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('task-modal').classList.remove('active');
        }

        async function saveTask(e) {
            e.preventDefault();

            const taskId = document.getElementById('task-id-input').value;
            const title = document.getElementById('task-title-input').value;
            const description = document.getElementById('task-description-input').value;
            const priority = document.getElementById('task-priority-input').value;
            const status = document.getElementById('task-status-input').value;

            const taskData = {
                title,
                description,
                priority,
                status,
                type: 'task',
                project_id: PROJECT_ID
            };

            try {
                let response;
                if (taskId) {
                    // Update existing task
                    taskData.id = taskId;
                    response = await fetch(`${API_BASE}/tasks`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(taskData)
                    });
                } else {
                    // Create new task
                    response = await fetch(`${API_BASE}/tasks`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${API_KEY}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(taskData)
                    });
                }

                if (!response.ok) {
                    throw new Error(`Failed to save task: ${response.status}`);
                }

                closeModal();
                await loadTasks();
            } catch (error) {
                showError(`Failed to save task: ${error.message}`);
            }
        }

        async function deleteTask(taskId) {
            if (!confirm('Are you sure you want to delete this task?')) return;

            try {
                const response = await fetch(`${API_BASE}/tasks?id=${taskId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${API_KEY}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`Failed to delete task: ${response.status}`);
                }

                await loadTasks();
            } catch (error) {
                showError(`Failed to delete task: ${error.message}`);
            }
        }

        function filterTasks(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderTasks();
        }

        function showLoader(show) {
            document.getElementById('loader').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            const container = document.getElementById('error-container');
            container.innerHTML = `<div class="error">${message}</div>`;
        }

        function hideError() {
            document.getElementById('error-container').innerHTML = '';
        }
    </script>
</body>
</html>
